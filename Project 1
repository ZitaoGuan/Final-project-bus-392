import matplotlib as ply
from datetime import datetime


def open_files():
    #initalizing lists

    #holds each line of data from txt file
    newlineHolder_list = []
    #holds each line of data from txt file
    lineHolder_list = []
    #holds every date from each line [string]
    date_list = []
    #holds every open from each line [string]
    open_list = []
    #holds every open from each line [float]
    high_list = []
    #holds every high from each line [float]
    low_list = []
    #holds every low from each line [float]
    close_list = []
    #holds every flose from each line [float]
    volume_list = []
    #holds every volume from each line [float]
    #asks user which file they want to read from
    file_name = input("Enter the file name: ")
    try:
        #opens file as data file
        with open(file_name, "r") as data_file:
            #foreach loop, line represents each line of data from txt file
            for data in data_file:
                line = data.splitlines()
                #foreach loop, so we can split the line into each indivdual data
                for str in line:
                    x = str.replace(",", "\n", 5)
                    y = x.replace('"', '')
                    #append each data we splitted
                    lineHolder_list.append(y.splitlines())
            #removed the first line which is [Date,Open,High,Low,Close,Volume]
            #because these are all strings which cant be converted into a float
            lineHolder_list.pop(0)
            #foreach loop, store each data type into list and at the same time making it the desire data type we want
            for line in lineHolder_list:
                date_list.append(line[0])
                open_list.append(float(line[1]))
                high_list.append(float(line[2]))
                low_list.append(float(line[3]))
                close_list.append(float(line[4]))
                volume_list.append(float((line[5]).replace(",", "")))

            for i in range(0, len(date_list)):
                newlineHolder_list.append([date_list[i],open_list[i], high_list[i],low_list[i],close_list[i],volume_list[i]])
            
            print(newlineHolder_list)

    except FileNotFoundError:
        print("File not found, please input the correct file")
        quit()
    except:
        print("File does not work or does not have permission")
        quit()


def highest_closing(list_of_list):
    """Find the highest closing price from a list of list.

    Args:
        list_of_list: a list of list of the prices and dates

    Returns:
        a tuple of both the date and the highest closing price

    """
    #create variable to hold the highest closing price
    high_value = 0
    #create variable the day the highest closing price occur
    date = 0
    #initalize a for loop to look through the list of list
    for list_val in list_of_list:
        # if the value located in the 4th index of the 
        # list is higher than the variable high_Value
        if list_val[4] > high_value:
            #set the high_value variable to the closing price in the list
            high_value = list_val[4]
            #set the date to the date varibale to the day the price occur
            date = list_val[0]
    #returns the date and high_value variables in a tuple
    return (date, high_value)


def lowest_opening(list_of_list):
    """Find the lowest opening price from a list of list.

    Args:
        list_of_list: a list of list of the prices and dates

    Returns:
        a tuple of both the date and the lowest opening price

    """
    #create variable to hold the lowest opening price
    low_value = 0
    #create variable the day the lowest opening price occur
    date = 0
    #initalize a for loop to look through the list of list
    for list_val in list_of_list:
        # if the value located in the 1th index of the 
        # list is lower than the variable low_value
        if list_val[1] < low_value:
            #set the low_value variable to the lowest opening in the list
            low_value = list_val[1]
            #set the date to the date varibale to the day the price occur
            date = list_val[0]
    #returns the date and low_value variables in a tuple
    return (date, low_value)


def top_ten_highest_closing(list_of_list):
    """Find the ten highest prices from a list of list.

    Args:
        list_of_list: a list of list of the prices and dates

    Returns:
        a list of tuple that has the ten highest prices and the dates that it occur

    """
    #create an empty list
    top_ten = []
    #set a variable to a sorted of the list
    #The sorted function will create a new list 
    #that is sorted from highest value to the lowest value
    #the reverse=True allow me to create that
    #The key=lambda x:x [4] is a function that let me look through the
    #list of list and only picking the value in the 4th index from that list
    #within the list
    sorted_list = sorted(list_of_list, reverse=True, key=lambda x:x[4])
    # initalize a for loop to only loop 10 times
    for index in range(10):
        # Append the sorted list by going through each of the 
        # list only up to the tenth one 
        top_ten.append((sorted_list[index][0], sorted_list[index][4]))
    return top_ten


def top_ten_lowest_opening(list_of_list):
    low_ten = []
    sorted_list = sorted(list_of_list, key=lambda x:x[1])
    for index in range(10):
        low_ten.append((sorted_list[index][0],sorted_list[index][1]))
    return low_ten


def filter_month(list_of_list):
    list_filter_month = []
    for list_val in list_of_list:
        if (list_val[0][:2]+'/'+list_val[0][6:10])in list_filter_month:
            continue
        list_filter_month.append(list_val[0][:2]+'/'+list_val[0][6:10])
    return list_filter_month


def one_month_average(list_opening):
    return sum(list_opening)/len(list_opening)


def average_month_opening(list_of_list, months):
    """
    Parameter: 
        list_of_list: a list of a list of value from the csv file 
        months :a list of months as well as years
    returns:
        a list of tuple of all the average for every months' opening price
    """
    list_average_opening = []
    starting_point = 0
    for list_mon in months:
        month_year = list_mon.split('/')
        list_one_opening = []
        for list_index in range(starting_point, len(list_of_list)):
            date_list = list_of_list[list_index][0].split('/')
            if list_index + 1 == len(list_of_list) and\
                month_year[0] != date_list[0] or month_year[1] != date_list[2]:
                list_average_opening.append((list_mon, one_month_average(list_one_opening)))
                starting_point = list_index
                break
            elif list_index + 1 == len(list_of_list) and\
                (month_year[0] == date_list[0] and\
                month_year[1] == date_list[2]) and\
                months.index(list_mon) + 1 == len(months):
                list_one_opening.append(list_of_list[list_index][1])
                list_average_opening.append((list_mon, one_month_average(list_one_opening)))
            elif list_index + 1 == len(list_of_list) and\
                (month_year[0] == date_list[0] and\
                month_year[1] == date_list[2]):
                list_one_opening = []
                list_one_opening.append(list_of_list[list_index][1])
                list_average_opening.append((list_mon, one_month_average(list_one_opening)))
            elif month_year[0] == date_list[0] and month_year[1] == date_list[2]:
                list_one_opening.append(list_of_list[list_index][1])
            elif month_year[0] != date_list[0] or month_year[1] != date_list[2]:
                list_average_opening.append(
                    (list_mon, one_month_average(list_one_opening))
                )
                starting_point = list_index
                break
    return list_average_opening


def average_month_closing(list_of_list, months):
    """
    Parameter: 
        list_of_list: a list of a list of value from the csv file 
        months :a list of months as well as years
    returns:
        a list of tuple of all the average for every months' closing price
    """
    list_average_closing = []
    starting_point = 0
    for list_mon in months:
        month_year = list_mon.split('/')
        list_one_closing = []
        for list_index in range(starting_point, len(list_of_list)):
            date_list = list_of_list[list_index][0].split('/')
            if list_index + 1 == len(list_of_list) and\
                month_year[0] != date_list[0] or month_year[1] != date_list[2]:
                list_average_closing.append((list_mon, one_month_average(list_one_closing)))
                starting_point = list_index
                break
            elif list_index + 1 == len(list_of_list) and\
                (month_year[0] == date_list[0] and\
                month_year[1] == date_list[2]) and\
                months.index(list_mon) + 1 == len(months):
                list_one_closing.append(list_of_list[list_index][4])
                list_average_closing.append((list_mon, one_month_average(list_one_closing)))
            elif list_index + 1 == len(list_of_list) and\
                (month_year[0] == date_list[0] and\
                month_year[1] == date_list[2]):
                list_one_closing = []
                list_one_closing.append(list_of_list[list_index][4])
                list_average_closing.append((list_mon, one_month_average(list_one_closing)))
            elif month_year[0] == date_list[0] and month_year[1] == date_list[2]:
                list_one_closing.append(list_of_list[list_index][4])
            elif month_year[0] != date_list[0] or month_year[1] != date_list[2]:
                list_average_closing.append(
                    (list_mon, one_month_average(list_one_closing))
                )
                starting_point = list_index
                break
    return list_average_closing


def convert_tuple_date(list_tuple):
    list_date = []
    for val_tuple in list_tuple:
        list_date.append(val_tuple[0])
    return list_date


def convert_tuple_avg(list_tuple):
    list_avg = []
    for val_tuple in list_tuple:
        list_avg.append(val_tuple[1])
    return list_avg
